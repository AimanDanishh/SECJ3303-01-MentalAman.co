<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- Question View Fragment -->
    <div th:fragment="question">
        <h1 class="text-3xl font-bold text-slate-900 mb-2">Self-Assessment Tools</h1>
        <p class="text-slate-600 mb-6">Complete confidential assessments to evaluate your mental health status</p>
        
        <div class="max-w-3xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg border border-slate-200">
                <!-- Card Header -->
                <div class="p-6 border-b border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-xl font-bold text-slate-900" th:text="${assessment.title}"></h2>
                            <p class="text-slate-600 text-sm mt-1">
                                Question <span th:text="${currentQuestionIndex + 1}"></span> 
                                of <span th:text="${assessment.questions.size()}"></span>
                            </p>
                        </div>
                        <a th:href="@{/assessment/clear}"
                           class="text-slate-400 hover:text-slate-600 transition-colors">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </a>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-200 rounded-full h-2">
                        <div class="h-2 rounded-full bg-blue-600 transition-all duration-300" 
                             th:style="'width: ' + ${progress} + '%'"></div>
                    </div>
                </div>

                <!-- Card Content -->
                <div class="p-6">
                    <form th:action="@{/assessment/submit}" method="post" class="space-y-4">
                        <div class="mb-8">
                            <h3 class="text-lg font-medium text-slate-900 mb-6" 
                                th:text="${currentQuestion.text}"></h3>

                            <!-- Scale Questions -->
                            <div th:if="${currentQuestion.type == 'scale'}">
                                <div class="space-y-3">
                                    <!-- Scale Labels Row -->
                                    <div th:if="${currentQuestion.scaleMax == 3}" class="flex justify-between text-sm text-slate-600 mb-2">
                                        <span>Not at all</span>
                                        <span>Several days</span>
                                        <span>Nearly every day</span>
                                    </div>
                                    <div th:if="${currentQuestion.scaleMax == 4}" class="flex justify-between text-sm text-slate-600 mb-2">
                                        <span>Never</span>
                                        <span>Sometimes</span>
                                        <span>Often</span>
                                        <span class="text-right">Always</span>
                                    </div>
                                    <div th:if="${currentQuestion.scaleMax == 5}" class="flex justify-between text-sm text-slate-600 mb-2">
                                        <span>Not at all</span>
                                        <span>Several days</span>
                                        <span>More than half</span>
                                        <span>Nearly every</span>
                                        <span class="text-right">Every day</span>
                                    </div>
                                    
                                    <!-- Radio Options -->
                                    <div class="space-y-3">
                                        <div th:each="value : ${#numbers.sequence(0, currentQuestion.scaleMax - 1)}">
                                            <label th:class="'flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all ' +
                                                            (${answers.get('q_' + currentQuestion.id)} == value ? 
                                                            'border-blue-500 bg-blue-50' : 
                                                            'border-slate-200 hover:border-slate-300 hover:bg-slate-50')">
                                                <input type="radio"
                                                    th:name="'q_' + ${currentQuestion.id}"
                                                    th:value="${value}"
                                                    th:checked="${answers.get('q_' + currentQuestion.id) == value}"
                                                    class="w-5 h-5 text-blue-600"
                                                    onchange="handleRadioChange(this)">
                                                <div class="ml-3">
                                                    <span class="font-medium text-slate-900" th:text="${value}"></span>
                                                    <span class="text-slate-600 ml-2">
                                                        <span th:if="${currentQuestion.scaleMax == 3}">
                                                            <span th:switch="${value}">
                                                                <span th:case="0">- Not at all</span>
                                                                <span th:case="1">- Several days</span>
                                                                <span th:case="2">- Nearly every day</span>
                                                            </span>
                                                        </span>
                                                        <span th:if="${currentQuestion.scaleMax == 4}">
                                                            <span th:switch="${value}">
                                                                <span th:case="0">- Never</span>
                                                                <span th:case="1">- Sometimes</span>
                                                                <span th:case="2">- Often</span>
                                                                <span th:case="3">- Always</span>
                                                            </span>
                                                        </span>
                                                        <span th:if="${currentQuestion.scaleMax == 5}">
                                                            <span th:switch="${value}">
                                                                <span th:case="0">- Not at all</span>
                                                                <span th:case="1">- Several days</span>
                                                                <span th:case="2">- More than half the days</span>
                                                                <span th:case="3">- Nearly every day</span>
                                                                <span th:case="4">- Every day</span>
                                                            </span>
                                                        </span>
                                                    </span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Multiple Choice Questions -->
                            <div th:if="${currentQuestion.type == 'multiple-choice'}">
                                <div class="space-y-3">
                                    <div th:each="option, stat : ${currentQuestion.options}">
                                        <label th:class="'flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all ' +
                                                        (${answers.get('q_' + currentQuestion.id)} == option.value ? 
                                                        'border-blue-500 bg-blue-50' : 
                                                        'border-slate-200 hover:border-slate-300 hover:bg-slate-50')">
                                            <input type="radio"
                                                th:name="q_${currentQuestion.id}"
                                                th:value="${option.value}"
                                                th:checked="${answers.get('q_' + currentQuestion.id) == option.value}"
                                                class="w-5 h-5 text-blue-600"
                                                onclick="this.form.submit()">
                                            <div class="ml-3 flex items-center gap-3">
                                                <span th:class="'w-8 h-8 rounded-full flex items-center justify-center ' +
                                                            (${answers.get('q_' + currentQuestion.id)} == option.value ? 
                                                                'bg-blue-100' : 'bg-slate-100')">
                                                    <span class="font-medium text-slate-900" 
                                                        th:text="${#strings.substring('ABCDE', stat.index, stat.index + 1)}"></span>
                                                </span>
                                                <span th:text="${option.text}" class="text-slate-900"></span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <input type="hidden" name="currentQuestionIndex" th:value="${currentQuestionIndex}">
                        
                        <div class="flex items-center justify-between gap-4 pt-6 border-t border-slate-200">
                            <button type="submit" name="nextStep" value="-1"
                                    th:disabled="${currentQuestionIndex == 0}"
                                    th:class="${currentQuestionIndex == 0} ? 
                                            'opacity-50 cursor-not-allowed px-6 py-3 border border-slate-300 text-slate-700 rounded-lg' :
                                            'px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors'">
                                Previous
                            </button>

                            <button type="submit" name="nextStep" value="3"
                                    class="px-6 py-3 border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50 transition-colors flex items-center gap-2">
                                <i data-lucide="save" class="w-4 h-4"></i>
                                Save Progress
                            </button>

                            <div th:if="${currentQuestionIndex == assessment.questions.size() - 1}">
                                <button type="submit" name="nextStep" value="2"
                                        class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                                    Submit Assessment
                                    <i data-lucide="check-circle" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <div th:unless="${currentQuestionIndex == assessment.questions.size() - 1}">
                                <button type="submit" name="nextStep" value="1"
                                        class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    Next
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Help Text -->
            <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                <p class="text-blue-800 text-sm flex items-start gap-2">
                    <i data-lucide="info" class="w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"></i>
                    <span>Your responses are confidential and will be accessible only to authorized counsellors and relevant faculty members.</span>
                </p>
            </div>
        </div>
    </div>
</body>
</html>