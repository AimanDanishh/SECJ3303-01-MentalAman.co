<th:block th:fragment="content(assessments, pastResults, savedProgress, assessment, currentQuestion, currentQuestionIndex, answers, progress, scaleLabels, assessmentScore, selectedReport, showResults, userRole, selectedStudent, assignedStudents, filteredStudents, searchQuery, filterRisk, showError, errorMessage, alert, alertType)">
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>if (typeof lucide !== 'undefined') lucide.createIcons();</script>
    
    <div class="p-8">
        
        <!-- Flash Alert Message -->
        <div th:if="${alert}" th:classappend="${alertType == 'success'} ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'"
             class="mb-6 p-4 border rounded-lg flex items-start gap-3 transition-opacity duration-300">
            <span th:text="${alert}"></span>
        </div>

        <!-- Error Alert -->
        <div th:if="${showError}" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
            <script>document.write('<i data-lucide="alert-circle" class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"></i>');</script>
            <div class="flex-1">
                <p class="font-medium text-red-900 mb-1">Error</p>
                <p class="text-red-700 text-sm" th:text="${errorMessage}"></p>
            </div>
        </div>

        <!-- Utility for badge colors -->
        <script>
            function getSeverityColor(severity) {
                switch (severity.toLowerCase()) {
                    case 'mild': return 'bg-green-100 text-green-800';
                    case 'moderate': return 'bg-yellow-100 text-yellow-800';
                    case 'severe': return 'bg-red-100 text-red-800';
                    default: return 'bg-slate-100 text-slate-800';
                }
            }
        </script>


        <!-- --- FACULTY/COUNSELLOR VIEW --- -->
        <div th:if="${userRole == 'faculty' or userRole == 'counsellor'}">
            <h1 class="text-3xl font-bold text-slate-900 mb-2">Student Assessment Reports</h1>
            <p class="text-slate-600 mb-6">View and monitor assessment reports for your assigned students</p>

            <!-- Student Detail View -->
            <div th:if="${selectedStudent != null}">
                <a th:href="@{/assessment(userRole=${userRole})}"
                   class="mb-6 px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex items-center w-fit">
                    <script>document.write('<i data-lucide="chevron-left" class="w-4 h-4"></i>');</script>
                    Back to Students
                </a>

                <!-- Student Header Card -->
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 mb-6 p-6">
                    <div class="flex items-start gap-4">
                        <div th:classappend="${selectedStudent.initialsColor}" class="w-16 h-16 rounded-full flex items-center justify-center flex-shrink-0 text-white text-xl">
                            <span th:text="${selectedStudent.initials}"></span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h2 class="text-2xl font-bold text-slate-900" th:text="${selectedStudent.name}"></h2>
                                <span th:class="${selectedStudent.riskLevel == 'high' ? 'bg-red-100 text-red-800' : (selectedStudent.riskLevel == 'moderate' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800')}"
                                      class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium uppercase"
                                      th:text="${selectedStudent.riskLevel} + ' RISK'">
                                </span>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-slate-600">
                                <div><p class="font-semibold text-slate-900" th:text="${selectedStudent.studentId}"></p><p>Student ID</p></div>
                                <div><p class="font-semibold text-slate-900" th:text="${selectedStudent.department}"></p><p>Department</p></div>
                                <div><p class="font-semibold text-slate-900" th:text="${selectedStudent.year}"></p><p>Year</p></div>
                                <div><p class="font-semibold text-blue-600" th:text="${selectedStudent.assessmentCount}"></p><p>Total Assessments</p></div>
                            </div>
                            
                            <!-- Upcoming Session Info -->
                            <div th:if="${selectedStudent.upcomingSession.isPresent()}" class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                <h3 class="font-semibold text-blue-900 mb-2 flex items-center gap-2">
                                    <script>document.write('<i data-lucide="calendar" class="w-4 h-4"></i>');</script>
                                    Upcoming Session
                                </h3>
                                <div th:with="session=${selectedStudent.upcomingSession.get()}" class="flex gap-4 text-sm text-blue-800">
                                    <span><span class="font-semibold" th:text="${session.date}"></span> at <span th:text="${session.time}"></span></span>
                                    <span>â€¢</span>
                                    <span th:text="${session.type}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assessment History -->
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6">
                    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2 mb-4 border-b pb-4">
                        <script>document.write('<i data-lucide="clipboard-list" class="w-5 h-5 text-blue-600"></i>');</script>
                        Assessment History
                    </h2>
                    <div th:if="${selectedStudent.assessmentHistory.size() > 0}" class="space-y-3">
                        <div th:each="result : ${selectedStudent.assessmentHistory}" class="p-4 bg-slate-50 rounded-lg flex items-center justify-between">
                            <div class="flex-1">
                                <p class="font-medium text-slate-900" th:text="${result.assessmentTitle}"></p>
                                <div class="flex items-center gap-3 mt-1">
                                    <span class="text-sm text-slate-600 flex items-center gap-1">
                                        <script>document.write('<i data-lucide="calendar" class="w-3 h-3"></i>');</script>
                                        <span th:text="${result.date}"></span>
                                    </span>
                                    <span th:class="${getSeverityColor(result.severity)}"
                                          class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium uppercase"
                                          th:text="${result.severity}">
                                    </span>
                                    <span class="text-sm text-slate-700">Score: <span th:text="${result.score} + '%'"></span></span>
                                </div>
                            </div>
                            <a th:if="${result.reportAvailable}" 
                               th:href="@{/assessment/report/view/{studentId}/{reportId}(studentId=${selectedStudent.id}, reportId=${result.id})}"
                               class="ml-4 px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors text-sm flex items-center gap-2">
                                <script>document.write('<i data-lucide="file-text" class="w-4 h-4"></i>');</script>
                                View Report
                            </a>
                        </div>
                    </div>
                    <p th:unless="${selectedStudent.assessmentHistory.size() > 0}" class="text-center text-slate-500 py-8">No assessment history available</p>
                </div>
            </div>

            <!-- Student List View -->
            <div th:unless="${selectedStudent != null}">
                <!-- Search and Filter Form -->
                <form th:action="@{/assessment}" method="get">
                    <input type="hidden" name="userRole" th:value="${userRole}" />
                    <div class="bg-white rounded-xl shadow-md border border-slate-200 mb-6 p-6">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="flex-1 relative">
                                <script>document.write('<i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"></i>');</script>
                                <input type="text" name="searchQuery" placeholder="Search by name, student ID, or email..." th:value="${searchQuery}"
                                       class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            <div class="flex items-center gap-2">
                                <script>document.write('<i data-lucide="filter" class="w-5 h-5 text-slate-600"></i>');</script>
                                <select name="filterRisk" onchange="this.form.submit()" class="px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option th:selected="${filterRisk == 'all'}" value="all">All Risk Levels</option>
                                    <option th:selected="${filterRisk == 'low'}" value="low">Low Risk</option>
                                    <option th:selected="${filterRisk == 'moderate'}" value="moderate">Moderate Risk</option>
                                    <option th:selected="${filterRisk == 'high'}" value="high">High Risk</option>
                                </select>
                            </div>
                            <button type="submit" class="hidden">Apply Search</button>
                        </div>
                    </div>
                </form>

                <!-- Student List -->
                <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6">
                    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2 mb-4 border-b pb-4">
                        <script>document.write('<i data-lucide="users" class="w-5 h-5 text-blue-600"></i>');</script>
                        Assigned Students (<span th:text="${filteredStudents.size()}"></span>)
                    </h2>
                    <div th:if="${filteredStudents.size() > 0}" class="space-y-3">
                        <a th:each="student : ${filteredStudents}" th:href="@{/assessment(userRole=${userRole}, selectStudentId=${student.id})}"
                           class="block p-4 border border-slate-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start gap-4 flex-1">
                                    <div th:classappend="${student.initialsColor}" class="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 text-white">
                                        <span th:text="${student.initials}"></span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <h3 class="font-semibold text-slate-900" th:text="${student.name}"></h3>
                                            <span th:class="${student.riskLevel == 'high' ? 'bg-red-100 text-red-800' : (student.riskLevel == 'moderate' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800')}"
                                                  class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium uppercase"
                                                  th:text="${student.riskLevel}">
                                            </span>
                                        </div>
                                        <p class="text-sm text-slate-600" th:text="${student.email}"></p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm text-slate-600 mb-1">Assessments</p>
                                    <p class="text-2xl font-bold text-blue-600" th:text="${student.assessmentCount}"></p>
                                    <p class="text-xs text-slate-500 mt-1">Last: <span th:text="${student.lastAssessment}"></span></p>
                                </div>
                            </div>
                        </a>
                    </div>
                    <p th:unless="${filteredStudents.size() > 0}" class="text-center text-slate-500 py-8">No matching students found.</p>
                </div>
            </div>
        </div>


        <!-- --- STUDENT VIEW (DEFAULT) --- -->
        <div th:if="${userRole == 'student'}">
            <!-- Tab Navigation (Only shows when not in assessment/results flow) -->
            <div th:unless="${assessment != null or showResults}" class="flex items-center gap-2 mb-6">
                <a th:href="@{/assessment(tab='assessments')}"
                    th:classappend="${activeTab == 'assessments'} ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
                    class="px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                    <script>document.write('<i data-lucide="clipboard-list" class="w-4 h-4"></i>');</script>
                    Assessments
                </a>
                <a th:href="@{/mood}"
                    th:classappend="${activeTab == 'mood'} ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
                    class="px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                    <script>document.write('<i data-lucide="heart" class="w-4 h-4"></i>');</script>
                    Daily Mood Tracker
                </a>
            </div>

            <!-- Assessment List & History Tab -->
            <div th:if="${activeTab == 'assessments' and assessment == null and !showResults}">
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6">
                        <h2 class="text-xl font-bold text-slate-900 mb-4 border-b pb-4">Available Assessments</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div th:each="assessment : ${assessments}" 
                                th:onclick="'window.location.href=\'' + @{/assessment/start/{id}(id=${assessment.id})} + '\''"
                                class="bg-slate-50 p-4 rounded-xl border border-slate-200 hover:shadow-md transition-shadow cursor-pointer">
                                
                                <div class="flex items-start justify-between mb-3">
                                    <div th:class="|w-12 h-12 rounded-lg bg-${assessment.color}-100 flex items-center justify-center|">
                                        <span th:utext="${#strings.escapeXml(getMoodIconHtml('clipboard-list', 'text-' + assessment.color + '-600', 'w-6 h-6'))}"></span>
                                    </div>
                                    <span th:if="${savedProgress != null and savedProgress.containsKey(assessment.id)}" class="inline-flex items-center rounded-full bg-blue-100 px-3 py-0.5 text-sm font-medium text-blue-800">
                                        <script>document.write('<i data-lucide="save" class="w-3 h-3 mr-1"></i>');</script>
                                        Saved
                                    </span>
                                </div>
                                <h3 class="text-lg font-semibold text-slate-900 mb-2" th:text="${assessment.title}"></h3>
                                <p class="text-slate-600 text-sm mb-4" th:text="${assessment.description}"></p>
                                <div class="flex items-center justify-between">
                                    <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-0.5 text-xs font-medium text-slate-800" th:text="${assessment.category}"></span>
                                    <span class="text-sm text-slate-600" th:text="${assessment.duration}"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6">
                        <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2 mb-4 border-b pb-4">
                            <script>document.write('<i data-lucide="trending-up" class="w-5 h-5 text-blue-600"></i>');</script>
                            Your Assessment History
                        </h2>
                        <div th:if="${pastResults.size() > 0}" class="space-y-3">
                            <div th:each="result : ${pastResults}" class="p-4 bg-slate-50 rounded-lg flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="font-medium text-slate-900" th:text="${result.assessmentTitle}"></p>
                                    <div class="flex items-center gap-3 mt-1">
                                        <span class="text-sm text-slate-600 flex items-center gap-1">
                                            <script>document.write('<i data-lucide="calendar" class="w-3 h-3"></i>');</script>
                                            <span th:text="${result.date}"></span>
                                        </span>
                                        <span th:class="${getSeverityColor(result.severity)}"
                                              class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium uppercase"
                                              th:text="${result.severity}">
                                        </span>
                                        <span class="text-sm text-slate-700">Score: <span th:text="${result.score} + '%'"></span></span>
                                    </div>
                                </div>
                                <a th:if="${result.reportAvailable}" 
                                   th:onclick="'window.location.href=\'' + @{/assessment/results} + '\';'"
                                   class="ml-4 px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors text-sm flex items-center gap-2">
                                    <script>document.write('<i data-lucide="file-text" class="w-4 h-4"></i>');</script>
                                    View Report
                                </a>
                            </div>
                        </div>
                        <p th:unless="${pastResults.size() > 0}" class="text-center text-slate-500 py-8">No assessment history yet. Complete your first assessment above!</p>
                    </div>
                </div>
            </div>

            <!-- Assessment Question Flow -->
            <div th:if="${assessment != null and !showResults}" class="max-w-3xl mx-auto bg-white rounded-xl shadow-lg border border-slate-200">
                <div class="p-6 border-b">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-xl font-bold text-slate-900" th:text="${assessment.title}"></h2>
                            <p class="text-slate-600 text-sm mt-1">Question <span th:text="${currentQuestionIndex + 1}"></span> of <span th:text="${assessment.questions.size()}"></span></p>
                        </div>
                        <a th:href="@{/assessment}" class="text-slate-400 hover:text-slate-600 transition-colors">
                            <script>document.write('<i data-lucide="x" class="w-6 h-6"></i>');</script>
                        </a>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2">
                         <div class="bg-blue-600 h-2 rounded-full" th:style="'width: ' + ${progress} + '%'"></div>
                    </div>
                </div>

                <form th:action="@{/assessment/submit}" method="post">
                    <input type="hidden" name="currentQuestionIndex" th:value="${currentQuestionIndex}" />
                    
                    <div class="p-6">
                        <div class="mb-8">
                            <h3 class="text-lg font-medium text-slate-900 mb-6" th:text="${currentQuestion.text}"></h3>

                            <!-- Scale Questions Options -->
                            <div th:if="${currentQuestion.type == 'scale'}" class="space-y-3">
                                <label th:each="i : ${#numbers.sequence(0, currentQuestion.scaleMax)}"
                                       th:with="value=${i}, label=${scaleLabels.get(i)}"
                                       th:for="'q-' + ${currentQuestion.id} + '-' + ${value}"
                                       th:classappend="${answers.get(currentQuestion.id) == value} ? 'border-blue-500 bg-blue-50' : 'border-slate-200 hover:border-slate-300 hover:bg-slate-50'"
                                       class="flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all">
                                    <input type="radio" required th:id="'q-' + ${currentQuestion.id} + '-' + ${value}" th:name="'q_' + ${currentQuestion.id}" th:value="${value}" 
                                           th:checked="${answers.get(currentQuestion.id) == value}"
                                           class="w-5 h-5 text-blue-600" />
                                    <div class="ml-3">
                                        <span class="font-medium text-slate-900" th:text="${value}"></span>
                                        <span class="text-slate-600 ml-2">- <span th:text="${label}"></span></span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="flex items-center justify-between gap-4 pt-4 border-t border-slate-200">
                            <!-- Previous Button -->
                            <button type="submit" name="nextStep" value="-1" th:disabled="${currentQuestionIndex == 0}"
                                    class="px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                Previous
                            </button>
                            
                            <!-- Save Progress Button -->
                            <button type="submit" name="nextStep" value="3" 
                                    class="px-6 py-3 border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50 transition-colors flex items-center gap-2">
                                <script>document.write('<i data-lucide="save" class="w-4 h-4"></i>');</script>
                                Save Progress
                            </button>

                            <!-- Next/Submit Button -->
                            <button type="submit" 
                                    th:name="nextStep" 
                                    th:value="${currentQuestionIndex == assessment.questions.size() - 1 ? 2 : 1}"
                                    th:classappend="${currentQuestionIndex == assessment.questions.size() - 1} ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'"
                                    class="px-6 py-3 text-white rounded-lg transition-colors flex items-center gap-2">
                                <span th:text="${currentQuestionIndex == assessment.questions.size() - 1 ? 'Submit Assessment' : 'Next'}"></span>
                                <script th:if="${currentQuestionIndex == assessment.questions.size() - 1}">document.write('<i data-lucide="check-circle" class="w-4 h-4"></i>');</script>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Assessment Results Display -->
            <div th:if="${showResults}" class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg border border-slate-200 p-6">
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4 border-b pb-4">Assessment Complete</h2>

                    <div class="w-32 h-32 mx-auto mb-6 rounded-full bg-green-100 flex items-center justify-center">
                        <script>document.write('<i data-lucide="check-circle" class="w-16 h-16 text-green-600"></i>');</script>
                    </div>
                    
                    <h3 class="text-2xl font-bold text-slate-900 mb-2">Your Score: <span th:text="${assessmentScore} + '%'"></span></h3>
                    <span th:with="severity=${assessmentScore < 33 ? 'Mild' : (assessmentScore < 66 ? 'Moderate' : 'Severe')}"
                          th:classappend="|mb-6 text-lg py-2 px-4 inline-flex items-center rounded-full font-semibold uppercase ${getSeverityColor(severity)}|"
                          th:text="${severity}">
                    </span>

                    <div class="p-4 bg-blue-50 rounded-lg mb-6 text-left">
                        <p class="text-blue-900 font-medium mb-2">Report Summary</p>
                        <p class="text-blue-800 text-sm">
                            Your assessment has been completed and saved securely. The report is now available to authorized counsellors 
                            and relevant faculty members who can provide appropriate support and guidance.
                        </p>
                    </div>

                    <div class="flex gap-3">
                        <a th:href="@{/assessment}"
                            class="flex-1 py-3 px-4 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors text-center"
                        >
                            Back to Assessments
                        </a>
                        <a th:href="@{/assessment/report/view/1/{reportId}(reportId=${selectedReport.id})}"
                            class="flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2"
                        >
                            <script>document.write('<i data-lucide="file-text" class="w-4 h-4"></i>');</script>
                            View Full Report
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Mood Tracker (Removed for student view to avoid complexity; handled by separate /mood route) -->
        </div>

        <!-- Report Modal (For Student OR Counsellor/Faculty) -->
        <div th:if="${showReportModal}" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-slate-900">Assessment Report</h2>
                    <a th:href="@{/assessment(selectStudentId=${selectedStudent != null ? selectedStudent.id : null})}" class="text-slate-400 hover:text-slate-600 transition-colors">
                        <script>document.write('<i data-lucide="x" class="w-6 h-6"></i>');</script>
                    </a>
                </div>

                <div th:if="${selectedStudent != null}" class="mb-4 p-4 bg-blue-50 rounded-lg">
                    <p class="text-sm text-blue-800 mb-1">Student</p>
                    <p class="font-semibold text-blue-900" th:text="${selectedStudent.name} + ' (' + ${selectedStudent.studentId} + ')'"></p>
                </div>

                <div class="space-y-4">
                    <div class="p-4 bg-slate-50 rounded-lg">
                        <p class="text-sm text-slate-600 mb-1">Assessment</p>
                        <p class="font-semibold text-slate-900" th:text="${selectedReport.assessmentTitle}"></p>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-slate-50 rounded-lg">
                            <p class="text-sm text-slate-600 mb-1">Date Completed</p>
                            <p class="font-semibold text-slate-900" th:text="${selectedReport.date}"></p>
                        </div>
                        <div class="p-4 bg-slate-50 rounded-lg">
                            <p class="text-sm text-slate-600 mb-1">Score</p>
                            <p class="font-semibold text-slate-900" th:text="${selectedReport.score} + '%'"></p>
                        </div>
                    </div>

                    <div class="p-4 bg-slate-50 rounded-lg">
                        <p class="text-sm text-slate-600 mb-2">Severity Level</p>
                        <span th:class="${getSeverityColor(selectedReport.severity)}"
                              class="inline-flex items-center rounded-full px-3 py-0.5 text-sm font-medium uppercase"
                              th:text="${selectedReport.severity}">
                        </span>
                    </div>

                    <div th:with="severity=${selectedReport.severity}" class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="font-medium text-blue-900 mb-2">Clinical Interpretation</p>
                        <p class="text-blue-800 text-sm">
                            Based on the assessment responses, the student is experiencing <span th:text="${#strings.toLowerCase(severity)}"></span> levels of symptoms.
                            <span th:if="${severity == 'Mild'}"> This indicates manageable symptoms that may benefit from self-care strategies and monitoring.</span>
                            <span th:if="${severity == 'Moderate'}"> This suggests notable symptoms that would benefit from professional intervention and regular counselling.</span>
                            <span th:if="${severity == 'Severe'}"> This indicates significant distress requiring immediate professional attention and comprehensive support.</span>
                        </p>
                    </div>

                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <p class="font-medium text-green-900 mb-2">Professional Recommendations</p>
                        <ul class="text-green-800 text-sm space-y-1 list-disc list-inside">
                            <li>Schedule individual counselling sessions</li>
                            <li>Monitor progress with follow-up assessments</li>
                            <li th:if="${severity == 'Severe'}" class="font-semibold">Priority: Immediate intervention recommended</li>
                        </ul>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <a th:href="@{/assessment(selectStudentId=${selectedStudent != null ? selectedStudent.id : null})}"
                       class="flex-1 py-3 px-4 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors text-center">
                        Close
                    </a>
                    <a th:href="@{/counselling(modal='book')}"
                       class="flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-center">
                        Schedule Session
                    </a>
                </div>
            </div>
        </div>
    </div>
</th:block>