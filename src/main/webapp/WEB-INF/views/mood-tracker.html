<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Mental Health Hub - ' + ${currentView}">Self Assessment</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Custom Style Injection (Simulating the provided CSS theme) -->
    <style>
        :root {
            /* Using a subset of your provided colors for Tailwind classes */
            --color-primary: #1f50ff; /* Blue for primary actions */
            --color-secondary: #8b5cf6; /* Purple for secondary accents */
        }
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        h1 { font-size: 1.5rem; font-weight: 700; }
        h2 { font-size: 1.25rem; font-weight: 600; }
        /* Style adjustments for better blending with the provided color scheme */
        .bg-blue-600 { background-color: var(--color-primary); }
        .hover\:bg-blue-700:hover { background-color: #173dff; }
        .text-blue-600 { color: var(--color-primary); }
        .ring-blue-500:focus { border-color: var(--color-primary); box-shadow: 0 0 0 2px rgba(31, 80, 255, 0.5); }
    </style>
</head>
<body class="bg-slate-50">

    <!-- Main Container -->
    <div class="min-h-screen">

        <div class="flex min-h-screen">

        <!-- Sidebar Fragment -->
        <nav th:replace="~{sidebar :: sidebar(user=${user}, currentView=${currentView})}"></nav>

        <main class="flex-1 overflow-auto">
            
        <!-- Mobile Header with Menu Button (Replicates TSX mobile header) -->
        <div class="lg:hidden sticky top-0 z-30 bg-white border-b border-slate-200 px-4 py-3 flex items-center gap-3">
            <button
                onclick="toggleSidebar('open')"
                class="p-2 hover:bg-slate-100 rounded-lg transition-colors"
            >
                <script>document.write('<i data-lucide="menu" class="w-6 h-6 text-slate-600"></i>');</script>
            </button>
            <h2 class="font-semibold text-slate-900">Mental Health Hub</h2>
        </div>

        <!-- Main Content -->
        <main class="p-6">
            <!-- Flash Alert Message -->
            <div th:if="${alert}" 
                 th:classappend="${alertType == 'success'} ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'"
                 class="mb-6 p-4 border rounded-lg flex items-start gap-3 fade-in">
                <i data-lucide="check-circle" th:if="${alertType == 'success'}" class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"></i>
                <i data-lucide="alert-circle" th:unless="${alertType == 'success'}" class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"></i>
                <span th:text="${alert}"></span>
            </div>

            <!-- Error Alert -->
            <div th:if="${showError}" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3 fade-in">
                <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"></i>
                <div class="flex-1">
                    <p class="font-medium text-red-900 mb-1">Error</p>
                    <p class="text-red-700 text-sm" th:text="${errorMessage}"></p>
                </div>
            </div>

            <!-- View (Default) -->
            <div>
                <h1 class="text-3xl font-bold text-slate-900 mb-2">Self-Assessment Tools</h1>
                <p class="text-slate-600 mb-6">Complete confidential assessments to evaluate your mental health status</p>

                <!-- Tab Navigation -->
                <div class="flex items-center gap-2 mb-6">
                    <button
                        th:onclick="|window.location.href='@{/assessment(tab='assessments')}'|"
                        th:classappend="${activeTab == 'assessments'} ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
                        class="px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                        <i data-lucide="clipboard-list" class="w-4 h-4"></i>
                        Assessments
                    </button>
                    <button
                        th:onclick="|window.location.href='@{/mood}'|"
                        th:classappend="${activeTab == 'mood'} ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
                        class="px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        Daily Mood Tracker
                    </button>
                </div>

                <!-- View Tabs -->
                <div class="flex items-center gap-2 mb-6">
                    <a th:href="@{/mood(view='entry')}"
                        th:classappend="${view == 'entry'} ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
                        class="px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        Record Mood
                    </a>
                    <a th:href="@{/mood(view='history')}"
                        th:classappend="${view == 'history'} ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
                        class="px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                        <i data-lucide="calendar-days" class="w-4 h-4"></i>
                        History
                    </a>
                    <a th:href="@{/mood(view='trends')}"
                        th:classappend="${view == 'trends'} ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
                        class="px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                        <i data-lucide="bar-chart" class="w-4 h-4"></i>
                        Trends
                    </a>
                </div>

                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-slate-600">Current Streak</p>
                            <i data-lucide="trending-up" class="w-5 h-5 text-blue-600"></i>
                        </div>
                        <p class="text-3xl font-bold text-slate-900" th:text="${currentStreak}"></p>
                        <p class="text-sm text-slate-600 mt-1" th:text="${currentStreak == 1 ? 'day' : 'days'}"></p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-slate-600">Total Entries</p>
                            <i data-lucide="calendar" class="w-5 h-5 text-purple-600"></i>
                        </div>
                        <p class="text-3xl font-bold text-slate-900" th:text="${totalEntries}"></p>
                        <p class="text-sm text-slate-600 mt-1">mood logs</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-slate-600">This Week</p>
                            <div th:if="${totalEntriesLast7Days > 0}" 
                                 th:class="${mostFrequentMoodData.bg} + ' w-8 h-8 rounded-full flex items-center justify-center'">
                                <i th:attr="data-lucide=${mostFrequentMoodId == 'happy' ? 'smile' : 
                                                        mostFrequentMoodId == 'sad' ? 'frown' : 
                                                        mostFrequentMoodId == 'stressed' ? 'angry' : 
                                                        mostFrequentMoodId == 'excited' ? 'laugh' : 
                                                        mostFrequentMoodId == 'anxious' ? 'heart' : 'meh'}"
                                   th:class="${mostFrequentMoodData.color} + ' w-5 h-5'"></i>
                            </div>
                        </div>
                        <p class="text-3xl font-bold text-slate-900" th:text="${totalEntriesLast7Days}"></p>
                        <p class="text-sm text-slate-600 mt-1">
                            <span th:text="${totalEntriesLast7Days > 0 ? 'Mostly ' + mostFrequentMoodId : 'No entries yet'}"></span>
                        </p>
                    </div>
                </div>

                <!-- Entry View -->
                <div th:if="${view == 'entry'}">
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl text-slate-600 flex items-center gap-2">
                                <i data-lucide="heart" class="w-5 h-5 text-blue-600"></i>
                                <span th:unless="${isEditing}">Record Today's Mood</span>
                            </h2>
                            <a th:if="${isEditing}" th:href="@{/mood}" class="text-slate-700 hover:text-slate-900">Cancel</a>
                        </div>

                        <form th:action="@{/mood/submit}" method="post" th:object="${formData}">
                            <input type="hidden" th:field="*{id}" />
                            <div class="space-y-6">
                                <!-- Date Selection -->
                                <div>
                                    <label for="date" class="block text-sm font-medium text-slate-900 mb-2">Date</label>
                                    <input type="date" id="date" th:field="*{date}" required
                                        th:attr="max=${#temporals.format(#temporals.createToday(), 'yyyy-MM-dd')}"
                                        class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>

                                <!-- Mood Selection -->
                                <div>
                                    <label class="block text-sm font-medium text-slate-900 mb-4">How are you feeling? <span class="text-red-600">*</span></label>
                                    <div class="grid grid-cols-3 md:grid-cols-6 gap-4">
                                        <div th:each="moodDef : ${moodDefinitions}" class="flex flex-col">
                                        <input type="radio" th:id="${moodDef.id}" th:field="*{mood}" th:value="${moodDef.id}" 
                                            class="hidden peer" th:checked="${formData.mood == moodDef.id}">
                                        <label th:for="${moodDef.id}"
                                            th:class="'p-4 text-center cursor-pointer border-2 rounded-lg transition-all peer-checked:border-blue-500 peer-checked:bg-blue-50 border-slate-200 hover:border-slate-300 bg-white'">
                
                                        <i th:attr="data-lucide=${moodDef.id == 'happy' ? 'smile' : 
                                                                moodDef.id == 'sad' ? 'frown' : 
                                                                moodDef.id == 'stressed' ? 'angry' : 
                                                                moodDef.id == 'excited' ? 'laugh' : 
                                                                moodDef.id == 'anxious' ? 'heart' : 'meh'}"
                                            th:class="${moodDef.color} + ' w-8 h-8 mx-auto mb-2 block'"></i>
                
                                        <p th:class="${moodDef.color} + ' text-sm'" th:text="${moodDef.label}"></p>
                                        </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Notes -->
                                <div>
                                    <label for="notes" class="block text-sm font-medium text-slate-900 mb-2">Notes (Optional)</label>
                                    <textarea id="notes" th:field="*{notes}" 
                                              placeholder="What's causing this mood? Any specific events or feelings..." 
                                              rows="4"
                                              class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                                    <p class="text-xs text-slate-500 mt-1">Adding notes helps you understand patterns in your mood over time</p>
                                </div>
                                
                                <!-- Weekly Summary -->
                                <div th:if="${totalEntriesLast7Days > 0}" class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <p class="font-medium text-blue-900 mb-2">Weekly Summary</p>
                                    <p class="text-blue-800 text-sm">
                                        You have <span th:text="${totalEntriesLast7Days}"></span> entries this week. Your top mood is 
                                        <span class="font-semibold" th:text="${mostFrequentMoodId}"></span>.
                                    </p>
                                </div>

                                <!-- Action Buttons -->
                                <div class="flex gap-3 pt-4">
                                    <a th:if="${isEditing}" th:href="@{/mood}" 
                                       class="flex-1 py-3 px-4 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors text-center">
                                        Cancel
                                    </a>
                                    <button type="submit"
                                        class="flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                                        <i data-lucide="save" class="w-4 h-4"></i>
                                        <span th:text="${isEditing ? 'Update Entry' : 'Save Entry'}"></span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- History View -->
                <div th:if="${view == 'history'}" class="bg-white rounded-xl shadow-lg border border-slate-200 p-6">
                    <div th:if="${totalEntries > 0}">
                        <h2 class="text-xl text-slate-600 flex items-center gap-2 mb-6">
                            <i data-lucide="calendar-days" class="w-5 h-5 text-blue-600"></i>
                            <span>Mood History</span>
                        </h2>
                        
                        <div class="space-y-3">
                            <div th:each="entry : ${moodEntries}" class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start gap-4 flex-1">
                                        <!-- Fixed: Simplified without stream operations -->
                                        <div th:class="|w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 
                                                    ${entry.mood == 'happy' ? 'bg-green-100' : 
                                                        entry.mood == 'sad' ? 'bg-blue-100' : 
                                                        entry.mood == 'stressed' ? 'bg-red-100' : 
                                                        entry.mood == 'excited' ? 'bg-yellow-100' : 
                                                        entry.mood == 'anxious' ? 'bg-purple-100' : 
                                                        'bg-slate-100'}|">
                                            <i th:attr="data-lucide=${entry.mood == 'happy' ? 'smile' : 
                                                                    entry.mood == 'sad' ? 'frown' : 
                                                                    entry.mood == 'stressed' ? 'angry' : 
                                                                    entry.mood == 'excited' ? 'laugh' : 
                                                                    entry.mood == 'anxious' ? 'heart' : 'meh'}"
                                            th:class="|w-6 h-6 
                                                        ${entry.mood == 'happy' ? 'text-green-600' : 
                                                        entry.mood == 'sad' ? 'text-blue-600' : 
                                                        entry.mood == 'stressed' ? 'text-red-600' : 
                                                        entry.mood == 'excited' ? 'text-yellow-600' : 
                                                        entry.mood == 'anxious' ? 'text-purple-600' : 
                                                        'text-slate-500'}|"></i>
                                        </div>
                                        <div class="flex-1">
                                            <!-- Rest of your content here -->
                                            <div class="flex items-center gap-2 mb-1">
                                                <p class="font-semibold text-slate-900" th:text="${entry.date}"></p>
                                                <span th:class="|inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium uppercase
                                                            ${entry.mood == 'happy' ? 'bg-green-100 text-green-800' : 
                                                                entry.mood == 'sad' ? 'bg-blue-100 text-blue-800' : 
                                                                entry.mood == 'stressed' ? 'bg-red-100 text-red-800' : 
                                                                entry.mood == 'excited' ? 'bg-yellow-100 text-yellow-800' : 
                                                                entry.mood == 'anxious' ? 'bg-purple-100 text-purple-800' : 
                                                                'bg-slate-100 text-slate-800'}|"
                                                    th:text="${entry.mood}">
                                                </span>
                                            </div>
                                            <p th:if="${entry.notes}" class="text-slate-600 text-sm" th:text="${entry.notes}"></p>
                                            <p class="text-xs text-slate-500 mt-2">
                                                <span th:if="${entry.timestamp != null}">
                                                    <span th:text="${#temporals.format(#temporals.createDateTime(entry.timestamp), 'hh:mm a')}"></span>
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 ml-4">
                                        <a th:href="@{/mood(view='entry', editId=${entry.id})}"
                                        class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="Edit">
                                            <i data-lucide="edit-2" class="w-4 h-4"></i>
                                        </a>
                                        <form th:action="@{/mood/delete/{id}(id=${entry.id})}" method="post" 
                                            onsubmit="return confirm('Are you sure you want to delete this entry?');">
                                            <button type="submit" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="Delete">
                                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div th:unless="${totalEntries > 0}" class="text-center py-12">
                        <i data-lucide="heart" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i>
                        <p class="text-slate-600">No mood entries yet</p>
                        <p class="text-sm text-slate-500 mt-2">Start recording your daily mood to track patterns</p>
                    </div>
                </div>

                <!-- Trends View -->
                <div th:if="${view == 'trends'}">
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6">
                        <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2 mb-6">
                            <i data-lucide="bar-chart" class="w-5 h-5 text-blue-600"></i>
                            Mood Trends
                        </h2>
                        
                        <div th:if="${totalEntries > 0}">
                            <div class="space-y-6">
                                <!-- Last 7 Days Breakdown -->
                                <div>
                                    <h3 class="font-semibold text-slate-900 mb-4">Last 7 Days</h3>
                                    <div class="space-y-3">
                                        <!-- Happy -->
                                        <div class="space-y-2">
                                            <div th:with="happyCount=${moodCounts.get('happy') != null ? moodCounts.get('happy') : 0}, 
                                                        happyPercentage=${totalEntriesLast7Days > 0 ? (happyCount * 100.0 / totalEntriesLast7Days) : 0}">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="smile" class="w-5 h-5 text-green-600"></i>
                                                        <span class="text-sm font-medium text-slate-900">Happy</span>
                                                    </div>
                                                    <span class="text-sm text-slate-600" th:text="${happyCount} + ' ' + (happyCount == 1 ? 'day' : 'days')"></span>
                                                </div>
                                                <div class="w-full bg-slate-200 rounded-full h-2">
                                                    <div class="h-2 rounded-full bg-green-500" th:style="'width: ' + ${happyPercentage} + '%'"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Sad -->
                                        <div class="space-y-2">
                                            <div th:with="sadCount=${moodCounts.get('sad') != null ? moodCounts.get('sad') : 0}, 
                                                        sadPercentage=${totalEntriesLast7Days > 0 ? (sadCount * 100.0 / totalEntriesLast7Days) : 0}">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="frown" class="w-5 h-5 text-blue-600"></i>
                                                        <span class="text-sm font-medium text-slate-900">Sad</span>
                                                    </div>
                                                    <span class="text-sm text-slate-600" th:text="${sadCount} + ' ' + (sadCount == 1 ? 'day' : 'days')"></span>
                                                </div>
                                                <div class="w-full bg-slate-200 rounded-full h-2">
                                                    <div class="h-2 rounded-full bg-blue-500" th:style="'width: ' + ${sadPercentage} + '%'"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Stressed -->
                                        <div class="space-y-2">
                                            <div th:with="stressedCount=${moodCounts.get('stressed') != null ? moodCounts.get('stressed') : 0}, 
                                                        stressedPercentage=${totalEntriesLast7Days > 0 ? (stressedCount * 100.0 / totalEntriesLast7Days) : 0}">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="angry" class="w-5 h-5 text-red-600"></i>
                                                        <span class="text-sm font-medium text-slate-900">Stressed</span>
                                                    </div>
                                                    <span class="text-sm text-slate-600" th:text="${stressedCount} + ' ' + (stressedCount == 1 ? 'day' : 'days')"></span>
                                                </div>
                                                <div class="w-full bg-slate-200 rounded-full h-2">
                                                    <div class="h-2 rounded-full bg-red-500" th:style="'width: ' + ${stressedPercentage} + '%'"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Excited -->
                                        <div class="space-y-2">
                                            <div th:with="excitedCount=${moodCounts.get('excited') != null ? moodCounts.get('excited') : 0}, 
                                                        excitedPercentage=${totalEntriesLast7Days > 0 ? (excitedCount * 100.0 / totalEntriesLast7Days) : 0}">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="laugh" class="w-5 h-5 text-yellow-600"></i>
                                                        <span class="text-sm font-medium text-slate-900">Excited</span>
                                                    </div>
                                                    <span class="text-sm text-slate-600" th:text="${excitedCount} + ' ' + (excitedCount == 1 ? 'day' : 'days')"></span>
                                                </div>
                                                <div class="w-full bg-slate-200 rounded-full h-2">
                                                    <div class="h-2 rounded-full bg-yellow-500" th:style="'width: ' + ${excitedPercentage} + '%'"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Anxious -->
                                        <div class="space-y-2">
                                            <div th:with="anxiousCount=${moodCounts.get('anxious') != null ? moodCounts.get('anxious') : 0}, 
                                                        anxiousPercentage=${totalEntriesLast7Days > 0 ? (anxiousCount * 100.0 / totalEntriesLast7Days) : 0}">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="heart" class="w-5 h-5 text-purple-600"></i>
                                                        <span class="text-sm font-medium text-slate-900">Anxious</span>
                                                    </div>
                                                    <span class="text-sm text-slate-600" th:text="${anxiousCount} + ' ' + (anxiousCount == 1 ? 'day' : 'days')"></span>
                                                </div>
                                                <div class="w-full bg-slate-200 rounded-full h-2">
                                                    <div class="h-2 rounded-full bg-purple-500" th:style="'width: ' + ${anxiousPercentage} + '%'"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Neutral -->
                                        <div class="space-y-2">
                                            <div th:with="neutralCount=${moodCounts.get('neutral') != null ? moodCounts.get('neutral') : 0}, 
                                                        neutralPercentage=${totalEntriesLast7Days > 0 ? (neutralCount * 100.0 / totalEntriesLast7Days) : 0}">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="meh" class="w-5 h-5 text-gray-600"></i>
                                                        <span class="text-sm font-medium text-slate-900">Neutral</span>
                                                    </div>
                                                    <span class="text-sm text-slate-600" th:text="${neutralCount} + ' ' + (neutralCount == 1 ? 'day' : 'days')"></span>
                                                </div>
                                                <div class="w-full bg-slate-200 rounded-full h-2">
                                                    <div class="h-2 rounded-full bg-gray-500" th:style="'width: ' + ${neutralPercentage} + '%'"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Simple Mood Calendar -->
                                <div>
                                    <h3 class="font-semibold text-slate-900 mb-4">Recent Mood Calendar</h3>
                                    <div class="grid grid-cols-7 gap-2">
                                        <div th:each="entry, iterStat : ${moodEntries}" 
                                            th:if="${iterStat.index < 14}"
                                            th:class="|p-3 rounded-lg text-center 
                                                    ${entry.mood == 'happy' ? 'bg-green-100' : 
                                                        entry.mood == 'sad' ? 'bg-blue-100' : 
                                                        entry.mood == 'stressed' ? 'bg-red-100' : 
                                                        entry.mood == 'excited' ? 'bg-yellow-100' : 
                                                        entry.mood == 'anxious' ? 'bg-purple-100' : 
                                                        'bg-gray-100'}|"
                                            th:title="${entry.date} + ' - ' + ${entry.mood}">
                                            
                                            <p class="text-xs text-slate-600 mb-1">
                                                <!-- Extract day from date string (assuming format YYYY-MM-DD) -->
                                                <span th:text="${#strings.substring(entry.date, 8, 10)}"></span>
                                            </p>
                                            <i th:attr="data-lucide=${entry.mood == 'happy' ? 'smile' : 
                                                                    entry.mood == 'sad' ? 'frown' : 
                                                                    entry.mood == 'stressed' ? 'angry' : 
                                                                    entry.mood == 'excited' ? 'laugh' : 
                                                                    entry.mood == 'anxious' ? 'heart' : 'meh'}"
                                            th:class="|w-6 h-6 mx-auto block 
                                                        ${entry.mood == 'happy' ? 'text-green-600' : 
                                                        entry.mood == 'sad' ? 'text-blue-600' : 
                                                        entry.mood == 'stressed' ? 'text-red-600' : 
                                                        entry.mood == 'excited' ? 'text-yellow-600' : 
                                                        entry.mood == 'anxious' ? 'text-purple-600' : 
                                                        'text-gray-600'}|"></i>
                                        </div>
                                        
                                        <!-- Fill empty slots -->
                                        <div th:each="i : ${#numbers.sequence(1, 14 - (moodEntries.size() < 14 ? moodEntries.size() : 14))}" 
                                            class="p-3 bg-slate-100 rounded-lg text-center opacity-50">
                                            <p class="text-xs text-slate-400 mb-1">--</p>
                                            <i data-lucide="meh" class="w-6 h-6 text-slate-400 mx-auto block"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Insights -->
                                <div class="p-4 bg-purple-50 border border-purple-200 rounded-lg">
                                    <p class="font-medium text-purple-900 mb-2">Insights</p>
                                    <ul class="text-purple-800 text-sm space-y-1 list-disc list-inside">
                                        <li th:if="${currentStreak > 0}" 
                                            th:text="'You&apos;re on a ' + ${currentStreak} + '-day tracking streak! Keep it up! ðŸŽ‰'"></li>
                                        <li th:if="${mostFrequentCount >= 3}" 
                                            th:text="'You&apos;ve been feeling mostly ' + ${mostFrequentMoodId} + ' this week'"></li>
                                        <li th:if="${totalEntries >= 7}" 
                                            th:text="'Great job tracking your mood for ' + ${totalEntries} + ' days total!'"></li>
                                        <li th:if="${totalEntriesLast7Days < 7}">
                                            Try to log your mood every day for better insights
                                        </li>
                                    </ul>
                                </div>

                                <!-- Counselor Access Note -->
                                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <p class="text-sm text-blue-800">
                                        <i data-lucide="bar-chart" class="w-5 h-5 text-blue-600 inline-block mr-2"></i>
                                        Your mood trends are accessible to authorized counsellors who can provide personalized support based on your emotional patterns.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div th:unless="${totalEntries > 0}" class="text-center py-12">
                            <i data-lucide="bar-chart" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i>
                            <p class="text-slate-600">No mood data to display yet</p>
                            <p class="text-sm text-slate-500 mt-2">Start tracking your mood to see trends and insights</p>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Auto-hide alerts after 5 seconds
            setTimeout(() => {
                const alerts = document.querySelectorAll('[th\\:if*="alert"]');
                alerts.forEach(alert => {
                    alert.style.opacity = '0';
                    alert.style.transition = 'opacity 0.5s';
                    setTimeout(() => alert.remove(), 500);
                });
            }, 5000);
        });
    </script>
</body>
</html>