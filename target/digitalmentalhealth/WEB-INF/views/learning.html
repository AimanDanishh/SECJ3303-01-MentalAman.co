<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<!-- ================= MAIN FRAGMENT ================= -->
<th:block th:fragment="content">

<div class="p-8 bg-slate-50 min-h-screen">

    <!-- ================= QUIZ MODE ================= -->
    <th:block th:if="${quizQuestions != null}">
        <div th:replace="quiz :: content"></div>
    </th:block>

    <!-- ================= NORMAL LEARNING MODE ================= -->
    <th:block th:if="${quizQuestions == null}">

        <!-- HEADER -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-slate-900 mb-2">Learning Modules</h1>
            <p class="text-slate-600">Access comprehensive mental health literacy content</p>
        </div>

        <!-- STATS -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <p class="text-slate-500 text-sm">Total Modules</p>
                    <p class="text-3xl font-bold" th:text="${totalModules}"></p>
                </div>
                <div>
                    <p class="text-slate-500 text-sm">Completed</p>
                    <p class="text-3xl font-bold text-green-600"
                       th:text="${completedCount}"></p>
                </div>
                <div>
                    <p class="text-slate-500 text-sm">In Progress</p>
                    <p class="text-3xl font-bold text-blue-600"
                       th:text="${inProgressCount}"></p>
                </div>
                <div>
                    <p class="text-slate-500 text-sm">Total Time</p>
                    <p class="text-3xl font-bold">5.5 Hours</p>
                </div>
            </div>
        </div>

        <!-- MODULE LIST -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div th:each="module : ${modules}">
                <div class="bg-white rounded-2xl border shadow-sm p-6 flex flex-col">
                    <h3 class="text-xl font-bold mb-2"
                        th:text="${module.title}"></h3>
                    <p class="text-slate-600 text-sm mb-6"
                       th:text="${module.description}"></p>

                    <a th:href="@{/learning/module(moduleId=${module.id})}"
                       class="mt-auto w-full py-3 bg-blue-600 text-white rounded-xl font-bold text-center">
                        Start / Continue
                    </a>
                </div>
            </div>
        </div>

        <!-- ================= MODULE MODAL ================= -->
        <div th:if="${selectedModule != null}"
             class="fixed inset-0 bg-slate-900/60 flex items-center justify-center z-50 p-4">

            <div class="bg-white rounded-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden">

                <!-- MODAL HEADER -->
                <div class="p-6 border-b flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold"
                            th:text="${selectedModule.title}"></h2>
                        <p class="text-slate-500"
                           th:text="${selectedModule.description}"></p>
                    </div>
                    <a th:href="@{/learning}" class="text-xl">
                        <i class="fas fa-times"></i>
                    </a>
                </div>

                <!-- MODAL BODY -->
                <div class="flex-grow overflow-y-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-8">

                    <!-- LESSON LIST -->
                    <div>
                        <h3 class="font-bold mb-4">Lessons</h3>

                        <a th:each="lesson, i : ${lessons}"
                           th:href="@{/learning/module(moduleId=${selectedModule.id}, lessonId=${lesson.id})}"
                           class="block p-3 border rounded mb-2"
                           th:text="${i.count + '. ' + lesson.title}">
                        </a>

                        <!-- QUIZ LINK -->
                        <a th:href="@{/learning/quiz(moduleId=${selectedModule.id})}"
                           class="block mt-4 p-4 bg-purple-600 text-white rounded-xl font-bold text-center">
                            Take Final Quiz
                        </a>
                    </div>

                    <!-- LESSON CONTENT -->
                    <div class="lg:col-span-2"
                         th:if="${selectedLesson != null}">
                        <h3 class="text-2xl font-bold mb-4"
                            th:text="${selectedLesson.title}"></h3>

                        <iframe th:if="${selectedLesson.type == 'video'}"
                                th:src="${selectedLesson.url}"
                                class="w-full aspect-video rounded-xl"></iframe>

                        <img th:if="${selectedLesson.type == 'infographic'}"
                             th:src="${selectedLesson.url}"
                             class="w-full rounded-xl">
                    </div>

                </div>
            </div>
        </div>

    </th:block>
</div>

</th:block>
</body>
</html>
