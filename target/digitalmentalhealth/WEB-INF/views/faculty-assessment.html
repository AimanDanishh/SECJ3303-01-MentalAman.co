<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Mental Health Hub - ' + ${currentView}">Assessment Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-primary: #1f50ff;
            --color-secondary: #8b5cf6;
        }
        .bg-blue-600 { background-color: var(--color-primary); }
        .hover\:bg-blue-700:hover { background-color: #173dff; }
        .text-blue-600 { color: var(--color-primary); }
    </style>
</head>
<body class="bg-slate-50 font-sans">
    <div class="min-h-screen">
        <div class="flex min-h-screen">
            <!-- Sidebar -->
            <nav th:replace="~{sidebar :: sidebar(user=${user}, currentView=${currentView})}"></nav>

            <main class="flex-1 overflow-auto">
                <!-- Mobile Header -->
                <div class="lg:hidden sticky top-0 z-30 bg-white border-b border-slate-200 px-4 py-3 flex items-center gap-3">
                    <button onclick="toggleSidebar('open')" class="p-2 hover:bg-slate-100 rounded-lg transition-colors">
                        <i data-lucide="menu" class="w-6 h-6 text-slate-600"></i>
                    </button>
                    <h2 class="font-semibold text-slate-900">Mental Health Hub</h2>
                </div>

                <!-- Main Content -->
                <div class="p-8">
                    <!-- Page Header -->
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-slate-900 mb-2">Student Assessment Reports</h1>
                        <p class="text-slate-600">View and monitor assessment reports for your assigned students</p>
                    </div>

                    <!-- Student List View -->
                    <div th:if="${selectedStudent == null}">
                        <th:block th:replace="~{faculty-assessmentlist :: assessment-list}"></th:block>
                    </div>

                    <!-- Student Detail View -->
                    <div th:if="${selectedStudent != null}" id="studentDetailView">
                        <th:block th:replace="~{faculty-detaillist :: detail-list}"></th:block>
                    </div>
                </div>

                <!-- Report Modal -->
                            <div th:if="${selectedReport != null and selectedStudent != null}"
                                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <th:block th:replace="~{faculty-report :: report-list}"></th:block>
                            </div>
            </main>
        </div>
    </div>

    <script>
    // Define the selectStudent function globally
    function selectStudent(element) {
        const studentId = element.getAttribute('data-id');
        // Navigate to student detail view
        window.location.href = '/digitalmentalhealth/assessment?selectStudentId=' + studentId;
    }

    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
        
        // Event listeners for search and filter
        const searchInput = document.getElementById('searchInput');
        const riskFilter = document.getElementById('riskFilter');
        const searchForm = document.querySelector('form'); // Get the form
        
        // Remove the input event listener for instant search
        // Add keydown event for Enter key
        if (searchInput) {
            searchInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevent form submission if inside form
                    submitSearch();
                }
            });
        }
        
        if (riskFilter) {
            riskFilter.addEventListener('change', function() {
                submitSearch();
            });
        }
        
        // Add a search button (optional)
        // Or you can keep the hidden submit button and make it visible
    });
    
    function submitSearch() {
        const query = document.getElementById('searchInput')?.value || '';
        const filterValue = document.getElementById('riskFilter')?.value || 'all';
        
        // Build URL
        let url = '/digitalmentalhealth/assessment';
        const params = new URLSearchParams();
        
        if (query) {
            params.append('searchQuery', query);
        }
        params.append('filterRisk', filterValue);
        
        const paramString = params.toString();
        if (paramString) {
            url += '?' + paramString;
        }
        
        window.location.href = url;
    }
</script>
</body>
</html>